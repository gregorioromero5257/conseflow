"use strict";function listCacheClear(){this.__data__=[],this.size=0}function eq(e,t){return e===t||e!=e&&t!=t}function assocIndexOf(e,t){for(var r=e.length;r--;)if(eq(e[r][0],t))return r;return-1}function listCacheDelete(e){var t=this.__data__,r=assocIndexOf(t,e);if(r<0)return!1;return r==t.length-1?t.pop():splice.call(t,r,1),--this.size,!0}function listCacheGet(e){var t=this.__data__,r=assocIndexOf(t,e);return r<0?void 0:t[r][1]}function listCacheHas(e){return assocIndexOf(this.__data__,e)>-1}function listCacheSet(e,t){var r=this.__data__,n=assocIndexOf(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}function ListCache(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function stackClear(){this.__data__=new ListCache,this.size=0}function stackDelete(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function stackGet(e){return this.__data__.get(e)}function stackHas(e){return this.__data__.has(e)}function getRawTag(e){var t=hasOwnProperty$1.call(e,symToStringTag$1),r=e[symToStringTag$1];try{e[symToStringTag$1]=void 0;var n=!0}catch(e){}var i=nativeObjectToString.call(e);return n&&(t?e[symToStringTag$1]=r:delete e[symToStringTag$1]),i}function objectToString(e){return nativeObjectToString$1.call(e)}function baseGetTag(e){return null==e?void 0===e?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(e)?getRawTag(e):objectToString(e)}function isObject(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function isFunction(e){if(!isObject(e))return!1;var t=baseGetTag(e);return t==funcTag||t==genTag||t==asyncTag||t==proxyTag}function isMasked(e){return!!maskSrcKey&&maskSrcKey in e}function toSource(e){if(null!=e){try{return funcToString$1.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function baseIsNative(e){if(!isObject(e)||isMasked(e))return!1;return(isFunction(e)?reIsNative:reIsHostCtor).test(toSource(e))}function getValue(e,t){return null==e?void 0:e[t]}function getNative(e,t){var r=getValue(e,t);return baseIsNative(r)?r:void 0}function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{},this.size=0}function hashDelete(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function hashGet(e){var t=this.__data__;if(nativeCreate){var r=t[e];return r===HASH_UNDEFINED?void 0:r}return hasOwnProperty$2.call(t,e)?t[e]:void 0}function hashHas(e){var t=this.__data__;return nativeCreate?void 0!==t[e]:hasOwnProperty$3.call(t,e)}function hashSet(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=nativeCreate&&void 0===t?HASH_UNDEFINED$1:t,this}function Hash(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}}function isKeyable(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function getMapData(e,t){var r=e.__data__;return isKeyable(t)?r["string"==typeof t?"string":"hash"]:r.map}function mapCacheDelete(e){var t=getMapData(this,e).delete(e);return this.size-=t?1:0,t}function mapCacheGet(e){return getMapData(this,e).get(e)}function mapCacheHas(e){return getMapData(this,e).has(e)}function mapCacheSet(e,t){var r=getMapData(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}function MapCache(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function stackSet(e,t){var r=this.__data__;if(r instanceof ListCache){var n=r.__data__;if(!Map||n.length<LARGE_ARRAY_SIZE-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new MapCache(n)}return r.set(e,t),this.size=r.size,this}function Stack(e){var t=this.__data__=new ListCache(e);this.size=t.size}function baseAssignValue(e,t,r){"__proto__"==t&&defineProperty$1?defineProperty$1(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function assignMergeValue(e,t,r){(void 0===r||eq(e[t],r))&&(void 0!==r||t in e)||baseAssignValue(e,t,r)}function createBaseFor(e){return function(t,r,n){for(var i=-1,a=Object(t),o=n(t),s=o.length;s--;){var c=o[e?s:++i];if(!1===r(a[c],c,a))break}return t}}function cloneBuffer(e,t){if(t)return e.slice();var r=e.length,n=allocUnsafe?allocUnsafe(r):new e.constructor(r);return e.copy(n),n}function cloneArrayBuffer(e){var t=new e.constructor(e.byteLength);return new Uint8Array(t).set(new Uint8Array(e)),t}function cloneTypedArray(e,t){var r=t?cloneArrayBuffer(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}function copyArray(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}function overArg(e,t){return function(r){return e(t(r))}}function isPrototype(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||objectProto$5)}function initCloneObject(e){return"function"!=typeof e.constructor||isPrototype(e)?{}:baseCreate(getPrototype(e))}function isObjectLike(e){return null!=e&&"object"==typeof e}function baseIsArguments(e){return isObjectLike(e)&&baseGetTag(e)==argsTag}function isLength(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER}function isArrayLike(e){return null!=e&&isLength(e.length)&&!isFunction(e)}function isArrayLikeObject(e){return isObjectLike(e)&&isArrayLike(e)}function stubFalse(){return!1}function isPlainObject(e){if(!isObjectLike(e)||baseGetTag(e)!=objectTag)return!1;var t=getPrototype(e);if(null===t)return!0;var r=hasOwnProperty$5.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&funcToString$2.call(r)==objectCtorString}function baseIsTypedArray(e){return isObjectLike(e)&&isLength(e.length)&&!!typedArrayTags[baseGetTag(e)]}function baseUnary(e){return function(t){return e(t)}}function assignValue(e,t,r){var n=e[t];hasOwnProperty$6.call(e,t)&&eq(n,r)&&(void 0!==r||t in e)||baseAssignValue(e,t,r)}function copyObject(e,t,r,n){var i=!r;r||(r={});for(var a=-1,o=t.length;++a<o;){var s=t[a],c=n?n(r[s],e[s],s,r,e):void 0;void 0===c&&(c=e[s]),i?baseAssignValue(r,s,c):assignValue(r,s,c)}return r}function baseTimes(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function isIndex(e,t){return!!(t=null==t?MAX_SAFE_INTEGER$1:t)&&("number"==typeof e||reIsUint.test(e))&&e>-1&&e%1==0&&e<t}function arrayLikeKeys(e,t){var r=isArray(e),n=!r&&isArguments(e),i=!r&&!n&&isBuffer(e),a=!r&&!n&&!i&&isTypedArray(e),o=r||n||i||a,s=o?baseTimes(e.length,String):[],c=s.length;for(var l in e)!t&&!hasOwnProperty$7.call(e,l)||o&&("length"==l||i&&("offset"==l||"parent"==l)||a&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||isIndex(l,c))||s.push(l);return s}function nativeKeysIn(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}function baseKeysIn(e){if(!isObject(e))return nativeKeysIn(e);var t=isPrototype(e),r=[];for(var n in e)("constructor"!=n||!t&&hasOwnProperty$8.call(e,n))&&r.push(n);return r}function keysIn(e){return isArrayLike(e)?arrayLikeKeys(e,!0):baseKeysIn(e)}function toPlainObject(e){return copyObject(e,keysIn(e))}function baseMergeDeep(e,t,r,n,i,a,o){var s=e[r],c=t[r],l=o.get(c);if(l)assignMergeValue(e,r,l);else{var d=a?a(s,c,r+"",e,t,o):void 0,u=void 0===d;if(u){var h=isArray(c),f=!h&&isBuffer(c),p=!h&&!f&&isTypedArray(c);d=c,h||f||p?isArray(s)?d=s:isArrayLikeObject(s)?d=copyArray(s):f?(u=!1,d=cloneBuffer(c,!0)):p?(u=!1,d=cloneTypedArray(c,!0)):d=[]:isPlainObject(c)||isArguments(c)?(d=s,isArguments(s)?d=toPlainObject(s):(!isObject(s)||n&&isFunction(s))&&(d=initCloneObject(c))):u=!1}u&&(o.set(c,d),i(d,c,n,a,o),o.delete(c)),assignMergeValue(e,r,d)}}function baseMerge(e,t,r,n,i){e!==t&&baseFor(t,function(a,o){if(isObject(a))i||(i=new Stack),baseMergeDeep(e,t,o,r,baseMerge,n,i);else{var s=n?n(e[o],a,o+"",e,t,i):void 0;void 0===s&&(s=a),assignMergeValue(e,o,s)}},keysIn)}function identity(e){return e}function apply(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function overRest(e,t,r){return t=nativeMax(void 0===t?e.length-1:t,0),function(){for(var n=arguments,i=-1,a=nativeMax(n.length-t,0),o=Array(a);++i<a;)o[i]=n[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=n[i];return s[t]=r(o),apply(e,this,s)}}function constant(e){return function(){return e}}function shortOut(e){var t=0,r=0;return function(){var n=nativeNow(),i=HOT_SPAN-(n-r);if(r=n,i>0){if(++t>=HOT_COUNT)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function baseRest(e,t){return setToString(overRest(e,t,identity),e+"")}function isIterateeCall(e,t,r){if(!isObject(r))return!1;var n=typeof t;return!!("number"==n?isArrayLike(r)&&isIndex(t,r.length):"string"==n&&t in r)&&eq(r[t],e)}function createAssigner(e){return baseRest(function(t,r){var n=-1,i=r.length,a=i>1?r[i-1]:void 0,o=i>2?r[2]:void 0;for(a=e.length>3&&"function"==typeof a?(i--,a):void 0,o&&isIterateeCall(r[0],r[1],o)&&(a=i<3?void 0:a,i=1),t=Object(t);++n<i;){var s=r[n];s&&e(t,s,n,a)}return t})}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},OrgChart$1=function(){function e(t){classCallCheck(this,e),this._name="OrgChart",Promise.prototype.finally=function(e){var t=this.constructor;return this.then(function(r){return t.resolve(e()).then(function(){return r})},function(r){return t.resolve(e()).then(function(){throw r})})};var r=this,n=_extends({nodeTitle:"name",nodeId:"id",toggleSiblingsResp:!1,depth:999,chartClass:"",exportButton:!1,exportButtonName:"Export",exportFilename:"OrgChart",parentNodeSymbol:"",draggable:!1,direction:"t2b",pan:!1,zoom:!1,toggleCollapse:!0},t),i=n.data,a=document.createElement("div"),o=document.querySelector(n.chartContainer);if(this.options=n,delete this.options.data,this.chart=a,this.chartContainer=o,a.dataset.options=JSON.stringify(n),a.setAttribute("class","orgchart"+(""!==n.chartClass?" "+n.chartClass:"")+("t2b"!==n.direction?" "+n.direction:"")),"object"===(void 0===i?"undefined":_typeof(i)))this.buildHierarchy(a,n.ajaxURL?i:this._attachRel(i,"00"),0);else if("string"==typeof i&&i.startsWith("#"))this.buildHierarchy(a,this._buildJsonDS(document.querySelector(i).children[0]),0);else{var s=document.createElement("i");s.setAttribute("class","fa fa-circle-o-notch fa-spin spinner"),a.appendChild(s),this._getJSON(i).then(function(e){r.buildHierarchy(a,n.ajaxURL?e:r._attachRel(e,"00"),0)}).catch(function(e){console.error("failed to fetch datasource for orgchart",e)}).finally(function(){var e=a.querySelector(".spinner");e.parentNode.removeChild(e)})}if(a.addEventListener("click",this._clickChart.bind(this)),n.exportButton&&!o.querySelector(".oc-export-btn")){var c=document.createElement("button"),l=document.createElement("a");c.setAttribute("class","oc-export-btn"+(""!==n.chartClass?" "+n.chartClass:"")),"Export"===n.exportButtonName?c.innerHTML="Export":c.innerHTML=""+n.exportButtonName,c.addEventListener("click",this._clickExportButton.bind(this)),l.setAttribute("class","oc-download-btn"+(""!==n.chartClass?" "+n.chartClass:"")),l.setAttribute("download",n.exportFilename+".png"),o.appendChild(c),o.appendChild(l)}n.pan&&(o.style.overflow="hidden",a.addEventListener("mousedown",this._onPanStart.bind(this)),a.addEventListener("touchstart",this._onPanStart.bind(this)),document.body.addEventListener("mouseup",this._onPanEnd.bind(this)),document.body.addEventListener("touchend",this._onPanEnd.bind(this))),n.zoom&&(o.addEventListener("wheel",this._onWheeling.bind(this)),o.addEventListener("touchstart",this._onTouchStart.bind(this)),document.body.addEventListener("touchmove",this._onTouchMove.bind(this)),document.body.addEventListener("touchend",this._onTouchEnd.bind(this))),o.appendChild(a)}return createClass(e,[{key:"_closest",value:function(e,t){return e&&(t(e)&&e!==this.chart?e:this._closest(e.parentNode,t))}},{key:"_siblings",value:function(e,t){return Array.from(e.parentNode.children).filter(function(r){return r!==e&&(!t||e.matches(t))})}},{key:"_prevAll",value:function(e,t){for(var r=[],n=e.previousElementSibling;n;)t&&!n.matches(t)||r.push(n),n=n.previousElementSibling;return r}},{key:"_nextAll",value:function(e,t){for(var r=[],n=e.nextElementSibling;n;)t&&!n.matches(t)||r.push(n),n=n.nextElementSibling;return r}},{key:"_isVisible",value:function(e){return null!==e.offsetParent}},{key:"_addClass",value:function(e,t){e.forEach(function(e){t.indexOf(" ")>0?t.split(" ").forEach(function(t){return e.classList.add(t)}):e.classList.add(t)})}},{key:"_removeClass",value:function(e,t){e.forEach(function(e){t.indexOf(" ")>0?t.split(" ").forEach(function(t){return e.classList.remove(t)}):e.classList.remove(t)})}},{key:"_css",value:function(e,t,r){e.forEach(function(e){e.style[t]=r})}},{key:"_removeAttr",value:function(e,t){e.forEach(function(e){e.removeAttribute(t)})}},{key:"_one",value:function(e,t,r,n){e&&e.addEventListener(t,function i(a){try{r.call(n,a)}finally{e.removeEventListener(t,i)}})}},{key:"_getDescElements",value:function(e,t){var r=[];return e.forEach(function(e){return r.push.apply(r,toConsumableArray(e.querySelectorAll(t)))}),r}},{key:"_getJSON",value:function(e){return new Promise(function(t,r){var n=new XMLHttpRequest;n.open("GET",e),n.onreadystatechange=function(){4===this.readyState&&(200===this.status?t(JSON.parse(this.response)):r(new Error(this.statusText)))},n.responseType="json",n.setRequestHeader("Content-Type","application/json"),n.send()})}},{key:"_buildJsonDS",value:function(e){var t=this,r={name:e.firstChild.textContent.trim(),relationship:("LI"===e.parentNode.parentNode.nodeName?"1":"0")+(e.parentNode.children.length>1?1:0)+(e.children.length?1:0)};return e.id&&(r.id=e.id),e.querySelector("ul")&&Array.from(e.querySelector("ul").children).forEach(function(e){r.children||(r.children=[]),r.children.push(t._buildJsonDS(e))}),r}},{key:"_attachRel",value:function(e,t){if(e.relationship=t+(e.children&&e.children.length>0?1:0),e.children){var r=!0,n=!1,i=void 0;try{for(var a,o=e.children[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;this._attachRel(s,"1"+(e.children.length>1?1:0))}}catch(e){n=!0,i=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw i}}}return e}},{key:"_repaint",value:function(e){e&&(e.style.offsetWidth=e.offsetWidth)}},{key:"_isInAction",value:function(e){return e.querySelector(":scope > .edge").className.indexOf("fa-")>-1}},{key:"_getNodeState",value:function(e,t){var r=this,n=void 0,i={exist:!1,visible:!1};return"parent"===t?((n=this._closest(e,function(e){return e.classList&&e.classList.contains("nodes")}))&&(i.exist=!0),i.exist&&this._isVisible(n.parentNode.children[0])&&(i.visible=!0)):"children"===t?((n=this._closest(e,function(e){return"TR"===e.nodeName}).nextElementSibling)&&(i.exist=!0),i.exist&&this._isVisible(n)&&(i.visible=!0)):"siblings"===t&&((n=this._siblings(this._closest(e,function(e){return"TABLE"===e.nodeName}).parentNode)).length&&(i.exist=!0),i.exist&&n.some(function(e){return r._isVisible(e)})&&(i.visible=!0)),i}},{key:"getRelatedNodes",value:function(e,t){return"parent"===t?this._closest(e,function(e){return e.classList.contains("nodes")}).parentNode.children[0].querySelector(".node"):"children"===t?Array.from(this._closest(e,function(e){return"TABLE"===e.nodeName}).lastChild.children).map(function(e){return e.querySelector(".node")}):"siblings"===t?this._siblings(this._closest(e,function(e){return"TABLE"===e.nodeName}).parentNode).map(function(e){return e.querySelector(".node")}):[]}},{key:"_switchHorizontalArrow",value:function(e){var t=this.options,r=e.querySelector(".leftEdge"),n=e.querySelector(".rightEdge"),i=this._closest(e,function(e){return"TABLE"===e.nodeName}).parentNode;if(t.toggleSiblingsResp&&(void 0===t.ajaxURL||this._closest(e,function(e){return e.classList.contains(".nodes")}).dataset.siblingsLoaded)){var a=i.previousElementSibling,o=i.nextElementSibling;a&&(a.classList.contains("hidden")?(r.classList.add("fa-chevron-left"),r.classList.remove("fa-chevron-right")):(r.classList.add("fa-chevron-right"),r.classList.remove("fa-chevron-left"))),o&&(o.classList.contains("hidden")?(n.classList.add("fa-chevron-right"),n.classList.remove("fa-chevron-left")):(n.classList.add("fa-chevron-left"),n.classList.remove("fa-chevron-right")))}else{var s=this._siblings(i),c=!!s.length&&!s.some(function(e){return e.classList.contains("hidden")});r.classList.toggle("fa-chevron-right",c),r.classList.toggle("fa-chevron-left",!c),n.classList.toggle("fa-chevron-left",c),n.classList.toggle("fa-chevron-right",!c)}}},{key:"_hoverNode",value:function(e){var t=e.target,r=!1,n=t.querySelector(":scope > .topEdge"),i=t.querySelector(":scope > .bottomEdge"),a=t.querySelector(":scope > .leftEdge");"mouseenter"===e.type?(n&&(r=this._getNodeState(t,"parent").visible,n.classList.toggle("fa-chevron-up",!r),n.classList.toggle("fa-chevron-down",r)),i&&(r=this._getNodeState(t,"children").visible,i.classList.toggle("fa-chevron-down",!r),i.classList.toggle("fa-chevron-up",r)),a&&this._switchHorizontalArrow(t)):Array.from(t.querySelectorAll(":scope > .edge")).forEach(function(e){e.classList.remove("fa-chevron-up","fa-chevron-down","fa-chevron-right","fa-chevron-left")})}},{key:"_clickNode",value:function(e){var t=e.currentTarget,r=this.chart.querySelector(".focused");r&&r.classList.remove("focused"),t.classList.add("focused")}},{key:"_buildParentNode",value:function(e,t,r){var n=this,i=document.createElement("table");t.relationship=t.relationship||"001",this._createNode(t,0).then(function(e){var t=n.chart;e.classList.remove("slide-up"),e.classList.add("slide-down");var a=document.createElement("tr"),o=document.createElement("tr"),s=document.createElement("tr"),c=document.createElement("tr");a.setAttribute("class","hidden"),a.innerHTML='<td colspan="2"></td>',i.appendChild(a),o.setAttribute("class","lines hidden"),o.innerHTML='<td colspan="2"><div class="downLine"></div></td>',i.appendChild(o),s.setAttribute("class","lines hidden"),s.innerHTML='<td class="rightLine">&nbsp;</td><td class="leftLine">&nbsp;</td>',i.appendChild(s),c.setAttribute("class","nodes"),c.innerHTML='<td colspan="2"></td>',i.appendChild(c),i.querySelector("td").appendChild(e),t.insertBefore(i,t.children[0]),i.children[3].children[0].appendChild(t.lastChild),r()}).catch(function(e){console.error("Failed to create parent node",e)})}},{key:"_switchVerticalArrow",value:function(e){e.classList.toggle("fa-chevron-up"),e.classList.toggle("fa-chevron-down")}},{key:"showParent",value:function(e){var t=this._prevAll(this._closest(e,function(e){return e.classList.contains("nodes")}));this._removeClass(t,"hidden"),this._addClass(Array(t[0].children).slice(1,-1),"hidden");var r=t[2].querySelector(".node");this._one(r,"transitionend",function(){r.classList.remove("slide"),this._isInAction(e)&&this._switchVerticalArrow(e.querySelector(":scope > .topEdge"))},this),this._repaint(r),r.classList.add("slide"),r.classList.remove("slide-down")}},{key:"showSiblings",value:function(e,t){var r=this,n=[],i=this._closest(e,function(e){return"TABLE"===e.nodeName}).parentNode;n=t?"left"===t?this._prevAll(i):this._nextAll(i):this._siblings(i),this._removeClass(n,"hidden");var a=this._prevAll(this._closest(e,function(e){return e.classList.contains("nodes")}));if(i=Array.from(a[0].querySelectorAll(":scope > .hidden")),t?this._removeClass(i.slice(0,2*n.length),"hidden"):this._removeClass(i,"hidden"),!this._getNodeState(e,"parent").visible){this._removeClass(a,"hidden");var o=a[2].querySelector(".node");this._one(o,"transitionend",function(e){e.target.classList.remove("slide")},this),this._repaint(o),o.classList.add("slide"),o.classList.remove("slide-down")}n.forEach(function(e){Array.from(e.querySelectorAll(".node")).forEach(function(e){r._isVisible(e)&&(e.classList.add("slide"),e.classList.remove("slide-left","slide-right"))})}),this._one(n[0].querySelector(".slide"),"transitionend",function(){var t=this;n.forEach(function(e){t._removeClass(Array.from(e.querySelectorAll(".slide")),"slide")}),this._isInAction(e)&&(this._switchHorizontalArrow(e),e.querySelector(".topEdge").classList.remove("fa-chevron-up"),e.querySelector(".topEdge").classList.add("fa-chevron-down"))},this)}},{key:"hideSiblings",value:function(e,t){var r=this,n=this._closest(e,function(e){return"TABLE"===e.nodeName}).parentNode;if(this._siblings(n).forEach(function(e){e.querySelector(".spinner")&&(r.chart.dataset.inAjax=!1)}),!t||t&&"left"===t){this._prevAll(n).forEach(function(e){Array.from(e.querySelectorAll(".node")).forEach(function(e){r._isVisible(e)&&e.classList.add("slide","slide-right")})})}if(!t||t&&"left"!==t){this._nextAll(n).forEach(function(e){Array.from(e.querySelectorAll(".node")).forEach(function(e){r._isVisible(e)&&e.classList.add("slide","slide-left")})})}var i=[];this._siblings(n).forEach(function(e){Array.prototype.push.apply(i,Array.from(e.querySelectorAll(".slide")))});var a=[],o=!0,s=!1,c=void 0;try{for(var l,d=i[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){var u=l.value,h=this._closest(u,function(e){return e.classList.contains("nodes")}).previousElementSibling;a.push(h),a.push(h.previousElementSibling)}}catch(e){s=!0,c=e}finally{try{!o&&d.return&&d.return()}finally{if(s)throw c}}(a=[].concat(toConsumableArray(new Set(a)))).forEach(function(e){e.style.visibility="hidden"}),this._one(i[0],"transitionend",function(r){var o=this;a.forEach(function(e){e.removeAttribute("style")});var s=[];s=t?"left"===t?this._prevAll(n,":not(.hidden)"):this._nextAll(n,":not(.hidden)"):this._siblings(n);var c=Array.from(this._closest(n,function(e){return e.classList.contains("nodes")}).previousElementSibling.querySelectorAll(":scope > :not(.hidden)")).slice(1,t?2*s.length+1:-1);this._addClass(c,"hidden"),this._removeClass(i,"slide"),s.forEach(function(e){Array.from(e.querySelectorAll(".node")).slice(1).forEach(function(e){o._isVisible(e)&&(e.classList.remove("slide-left","slide-right"),e.classList.add("slide-up"))})}),s.forEach(function(e){o._addClass(Array.from(e.querySelectorAll(".lines")),"hidden"),o._addClass(Array.from(e.querySelectorAll(".nodes")),"hidden"),o._addClass(Array.from(e.querySelectorAll(".verticalNodes")),"hidden")}),this._addClass(s,"hidden"),this._isInAction(e)&&this._switchHorizontalArrow(e)},this)}},{key:"hideParent",value:function(e){var t=Array.from(this._closest(e,function(e){return e.classList.contains("nodes")}).parentNode.children).slice(0,3);t[0].querySelector(".spinner")&&(this.chart.dataset.inAjax=!1),this._getNodeState(e,"siblings").visible&&this.hideSiblings(e);var r=t.slice(1);this._css(r,"visibility","hidden");var n=t[0].querySelector(".node"),i=this._getNodeState(n,"parent").visible;n&&this._isVisible(n)&&(n.classList.add("slide","slide-down"),this._one(n,"transitionend",function(){n.classList.remove("slide"),this._removeAttr(r,"style"),this._addClass(t,"hidden")},this)),n&&i&&this.hideParent(n)}},{key:"addParent",value:function(e,t){var r=this;this._buildParentNode(e,t,function(){if(!e.querySelector(":scope > .topEdge")){var t=document.createElement("i");t.setAttribute("class","edge verticalEdge topEdge fa"),e.appendChild(t)}r.showParent(e)})}},{key:"_startLoading",value:function(e,t){var r=this.options,n=this.chart;if(void 0!==n.dataset.inAjax&&"true"===n.dataset.inAjax)return!1;e.classList.add("hidden");var i=document.createElement("i");i.setAttribute("class","fa fa-circle-o-notch fa-spin spinner"),t.appendChild(i),this._addClass(Array.from(t.querySelectorAll(":scope > *:not(.spinner)")),"hazy"),n.dataset.inAjax=!0;var a=this.chartContainer.querySelector(".oc-export-btn"+(""!==r.chartClass?"."+r.chartClass:""));return a&&(a.disabled=!0),!0}},{key:"_endLoading",value:function(e,t){var r=this.options;e.classList.remove("hidden"),t.querySelector(":scope > .spinner").remove(),this._removeClass(Array.from(t.querySelectorAll(":scope > .hazy")),"hazy"),this.chart.dataset.inAjax=!1;var n=this.chartContainer.querySelector(".oc-export-btn"+(""!==r.chartClass?"."+r.chartClass:""));n&&(n.disabled=!1)}},{key:"_clickTopEdge",value:function(e){e.stopPropagation();var t=this,r=e.target,n=r.parentNode,i=this._getNodeState(n,"parent"),a=this.options;if(i.exist){var o=this._closest(n,function(e){return e.classList.contains("nodes")}).parentNode.firstChild.querySelector(".node");if(o.classList.contains("slide"))return;i.visible?(this.hideParent(n),this._one(o,"transitionend",function(){this._isInAction(n)&&(this._switchVerticalArrow(r),this._switchHorizontalArrow(n))},this)):this.showParent(n)}else{var s=r.parentNode.id;this._startLoading(r,n)&&this._getJSON("function"==typeof a.ajaxURL.parent?a.ajaxURL.parent(n.dataset.source):a.ajaxURL.parent+s).then(function(e){"true"===t.chart.dataset.inAjax&&Object.keys(e).length&&t.addParent(n,e)}).catch(function(e){console.error("Failed to get parent node data.",e)}).finally(function(){t._endLoading(r,n)})}}},{key:"hideChildren",value:function(e){var t=this,r=this._nextAll(e.parentNode.parentNode),n=r[r.length-1],i=[];n.querySelector(".spinner")&&(this.chart.dataset.inAjax=!1);var a=Array.from(n.querySelectorAll(".node")).filter(function(e){return t._isVisible(e)}),o=n.classList.contains("verticalNodes");o||(a.forEach(function(e){Array.prototype.push.apply(i,t._prevAll(t._closest(e,function(e){return e.classList.contains("nodes")}),".lines"))}),i=[].concat(toConsumableArray(new Set(i))),this._css(i,"visibility","hidden")),this._one(a[0],"transitionend",function(s){this._removeClass(a,"slide"),o?t._addClass(r,"hidden"):(i.forEach(function(e){e.removeAttribute("style"),e.classList.add("hidden"),e.parentNode.lastChild.classList.add("hidden")}),this._addClass(Array.from(n.querySelectorAll(".verticalNodes")),"hidden")),this._isInAction(e)&&this._switchVerticalArrow(e.querySelector(".bottomEdge"))},this),this._addClass(a,"slide slide-up")}},{key:"showChildren",value:function(e){var t=this,r=this,n=this._nextAll(e.parentNode.parentNode),i=[];this._removeClass(n,"hidden"),n.some(function(e){return e.classList.contains("verticalNodes")})?n.forEach(function(e){Array.prototype.push.apply(i,Array.from(e.querySelectorAll(".node")).filter(function(e){return r._isVisible(e)}))}):Array.from(n[2].children).forEach(function(e){Array.prototype.push.apply(i,Array.from(e.querySelector("tr").querySelectorAll(".node")).filter(function(e){return r._isVisible(e)}))}),this._repaint(i[0]),this._one(i[0],"transitionend",function(r){t._removeClass(i,"slide"),t._isInAction(e)&&t._switchVerticalArrow(e.querySelector(".bottomEdge"))},this),this._addClass(i,"slide"),this._removeClass(i,"slide-up")}},{key:"_buildChildNode",value:function(e,t,r){var n=t.children||t.siblings;e.querySelector("td").setAttribute("colSpan",2*n.length),this.buildHierarchy(e,{children:n},0,r)}},{key:"addChildren",value:function(e,t){var r=this,n=this.options,i=0;this.chart.dataset.inEdit="addChildren",this._buildChildNode.call(this,this._closest(e,function(e){return"TABLE"===e.nodeName}),t,function(){if(++i===t.children.length){if(!e.querySelector(".bottomEdge")){var a=document.createElement("i");a.setAttribute("class","edge verticalEdge bottomEdge fa"),e.appendChild(a)}if(!e.querySelector(".symbol")){var o=document.createElement("i");o.setAttribute("class","fa "+n.parentNodeSymbol+" symbol"),e.querySelector(":scope > .title").appendChild(o)}r.showChildren(e),r.chart.dataset.inEdit=""}})}},{key:"_clickBottomEdge",value:function(e){var t=this;e.stopPropagation();var r=this,n=this.options,i=e.target,a=i.parentNode,o=this._getNodeState(a,"children");if(o.exist){var s=this._closest(a,function(e){return"TR"===e.nodeName}).parentNode.lastChild;if(Array.from(s.querySelectorAll(".node")).some(function(e){return t._isVisible(e)&&e.classList.contains("slide")}))return;o.visible?this.hideChildren(a):this.showChildren(a)}else{var c=i.parentNode.id;this._startLoading(i,a)&&this._getJSON("function"==typeof n.ajaxURL.children?n.ajaxURL.children(a.dataset.source):n.ajaxURL.children+c).then(function(e){"true"===r.chart.dataset.inAjax&&e.children.length&&r.addChildren(a,e)}).catch(function(e){console.error("Failed to get children nodes data",e)}).finally(function(){r._endLoading(i,a)})}}},{key:"_complementLine",value:function(e,t,r){var n=e.parentNode.parentNode.children;n[0].children[0].setAttribute("colspan",2*t),n[1].children[0].setAttribute("colspan",2*t);for(var i=0;i<r;i++){var a=document.createElement("td"),o=document.createElement("td");a.setAttribute("class","rightLine topLine"),a.innerHTML="&nbsp;",n[2].insertBefore(a,n[2].children[1]),o.setAttribute("class","leftLine topLine"),o.innerHTML="&nbsp;",n[2].insertBefore(o,n[2].children[1])}}},{key:"_buildSiblingNode",value:function(e,t,r){var n=this,i=this,a=t.siblings?t.siblings.length:t.children.length,o="TD"===e.parentNode.nodeName?this._closest(e,function(e){return"TR"===e.nodeName}).children.length:1,s=o+a,c=s>1?Math.floor(s/2-1):0;if("TD"===e.parentNode.nodeName){var l=this._prevAll(e.parentNode.parentNode);l[0].remove(),l[1].remove();var d=0;i._buildChildNode.call(i,i._closest(e.parentNode,function(e){return"TABLE"===e.nodeName}),t,function(){if(++d===a){var t=Array.from(i._closest(e.parentNode,function(e){return"TABLE"===e.nodeName}).lastChild.children);if(o>1){var n=e.parentNode.parentNode;Array.from(n.children).forEach(function(e){t[0].parentNode.insertBefore(e,t[0])}),n.remove(),i._complementLine(t[0],s,o),i._addClass(t,"hidden"),t.forEach(function(e){i._addClass(e.querySelectorAll(".node"),"slide-left")})}else{var l=e.parentNode.parentNode;t[c].parentNode.insertBefore(e.parentNode,t[c+1]),l.remove(),i._complementLine(t[c],s,1),i._addClass(t,"hidden"),i._addClass(i._getDescElements(t.slice(0,c+1),".node"),"slide-right"),i._addClass(i._getDescElements(t.slice(c+1),".node"),"slide-left")}r()}})}else{var u=0;i.buildHierarchy.call(i,i.chart,t,0,function(){if(++u===s){var t=e.nextElementSibling.children[3].children[c],a=document.createElement("td");a.setAttribute("colspan",2),a.appendChild(e),t.parentNode.insertBefore(a,t.nextElementSibling),i._complementLine(t,s,1);var o=i._closest(e,function(e){return e.classList&&e.classList.contains("nodes")}).parentNode.children[0];o.classList.add("hidden"),i._addClass(Array.from(o.querySelectorAll(".node")),"slide-down");var l=n._siblings(e.parentNode);i._addClass(l,"hidden"),i._addClass(i._getDescElements(l.slice(0,c),".node"),"slide-right"),i._addClass(i._getDescElements(l.slice(c),".node"),"slide-left"),r()}})}}},{key:"addSiblings",value:function(e,t){var r=this;this.chart.dataset.inEdit="addSiblings",this._buildSiblingNode.call(this,this._closest(e,function(e){return"TABLE"===e.nodeName}),t,function(){if(r._closest(e,function(e){return e.classList&&e.classList.contains("nodes")}).dataset.siblingsLoaded=!0,!e.querySelector(".leftEdge")){var t=document.createElement("i"),n=document.createElement("i");t.setAttribute("class","edge horizontalEdge rightEdge fa"),e.appendChild(t),n.setAttribute("class","edge horizontalEdge leftEdge fa"),e.appendChild(n)}r.showSiblings(e),r.chart.dataset.inEdit=""})}},{key:"removeNodes",value:function(e){var t=this._closest(e,function(e){return"TABLE"===e.nodeName}).parentNode,r=this._siblings(t.parentNode);"TD"===t.nodeName?this._getNodeState(e,"siblings").exist?(r[2].querySelector(".topLine").nextElementSibling.remove(),r[2].querySelector(".topLine").remove(),r[0].children[0].setAttribute("colspan",r[2].children.length),r[1].children[0].setAttribute("colspan",r[2].children.length),t.remove()):(r[0].children[0].removeAttribute("colspan"),r[0].querySelector(".bottomEdge").remove(),this._siblings(r[0]).forEach(function(e){return e.remove()})):Array.from(t.parentNode.children).forEach(function(e){return e.remove()})}},{key:"_clickHorizontalEdge",value:function(e){var t=this;e.stopPropagation();var r=this,n=this.options,i=e.target,a=i.parentNode,o=this._getNodeState(a,"siblings");if(o.exist){var s=this._closest(a,function(e){return"TABLE"===e.nodeName}).parentNode;if(this._siblings(s).some(function(e){var r=e.querySelector(".node");return t._isVisible(r)&&r.classList.contains("slide")}))return;if(n.toggleSiblingsResp){var c=this._closest(a,function(e){return"TABLE"===e.nodeName}).parentNode.previousElementSibling,l=this._closest(a,function(e){return"TABLE"===e.nodeName}).parentNode.nextElementSibling;i.classList.contains("leftEdge")?c&&c.classList.contains("hidden")?this.showSiblings(a,"left"):this.hideSiblings(a,"left"):l&&l.classList.contains("hidden")?this.showSiblings(a,"right"):this.hideSiblings(a,"right")}else o.visible?this.hideSiblings(a):this.showSiblings(a)}else{var d=i.parentNode.id,u=this._getNodeState(a,"parent").exist?"function"==typeof n.ajaxURL.siblings?n.ajaxURL.siblings(JSON.parse(a.dataset.source)):n.ajaxURL.siblings+d:"function"==typeof n.ajaxURL.families?n.ajaxURL.families(JSON.parse(a.dataset.source)):n.ajaxURL.families+d;this._startLoading(i,a)&&this._getJSON(u).then(function(e){"true"===r.chart.dataset.inAjax&&(e.siblings||e.children)&&r.addSiblings(a,e)}).catch(function(e){console.error("Failed to get sibling nodes data",e)}).finally(function(){r._endLoading(i,a)})}}},{key:"_clickToggleButton",value:function(e){var t=this,r=e.target,n=r.parentNode.nextElementSibling,i=Array.from(n.querySelectorAll(".node")),a=Array.from(n.children).map(function(e){return e.querySelector(".node")});a.some(function(e){return e.classList.contains("slide")})||(r.classList.toggle("fa-plus-square"),r.classList.toggle("fa-minus-square"),i[0].classList.contains("slide-up")?(n.classList.remove("hidden"),this._repaint(a[0]),this._addClass(a,"slide"),this._removeClass(a,"slide-up"),this._one(a[0],"transitionend",function(){t._removeClass(a,"slide")})):(this._addClass(i,"slide slide-up"),this._one(i[0],"transitionend",function(){t._removeClass(i,"slide"),i.forEach(function(e){t._closest(e,function(e){return"UL"===e.nodeName}).classList.add("hidden")})}),i.forEach(function(e){var r=Array.from(e.querySelectorAll(".toggleBtn"));t._removeClass(r,"fa-minus-square"),t._addClass(r,"fa-plus-square")})))}},{key:"_dispatchClickEvent",value:function(e){var t=e.target.classList;t.contains("topEdge")?this._clickTopEdge(e):t.contains("rightEdge")||t.contains("leftEdge")?this._clickHorizontalEdge(e):t.contains("bottomEdge")?this._clickBottomEdge(e):t.contains("toggleBtn")?this._clickToggleButton(e):this._clickNode(e)}},{key:"_onDragStart",value:function(e){var t=e.target,r=this.options,n=/firefox/.test(window.navigator.userAgent.toLowerCase());if(n&&e.dataTransfer.setData("text/html","hack for firefox"),this.chart.style.transform){var i=void 0,a=void 0;document.querySelector(".ghost-node")?a=(i=this.chart.querySelector(":scope > .ghost-node")).children[0]:((i=document.createElementNS("http://www.w3.org/2000/svg","svg")).classList.add("ghost-node"),a=document.createElementNS("http://www.w3.org/2000/svg","rect"),i.appendChild(a),this.chart.appendChild(i));var o=this.chart.style.transform.split(","),s=Math.abs(window.parseFloat("t2b"===r.direction||"b2t"===r.direction?o[0].slice(o[0].indexOf("(")+1):o[1]));i.setAttribute("width",t.offsetWidth),i.setAttribute("height",t.offsetHeight),a.setAttribute("x",5*s),a.setAttribute("y",5*s),a.setAttribute("width",120*s),a.setAttribute("height",40*s),a.setAttribute("rx",4*s),a.setAttribute("ry",4*s),a.setAttribute("stroke-width",1*s);var c=e.offsetX*s,l=e.offsetY*s;if("l2r"===r.direction?(c=e.offsetY*s,l=e.offsetX*s):"r2l"===r.direction?(c=t.offsetWidth-e.offsetY*s,l=e.offsetX*s):"b2t"===r.direction&&(c=t.offsetWidth-e.offsetX*s,l=t.offsetHeight-e.offsetY*s),n){var d=document.createElement("img");d.src="data:image/svg+xml;utf8,"+(new XMLSerializer).serializeToString(i),e.dataTransfer.setDragImage(d,c,l),a.setAttribute("fill","rgb(255, 255, 255)"),a.setAttribute("stroke","rgb(191, 0, 0)")}else e.dataTransfer.setDragImage(i,c,l)}var u=e.target,h=null;null!==this._closest(u,function(e){return e.classList&&e.classList.contains("nodes")})&&(h=this._closest(u,function(e){return e.classList&&e.classList.contains("nodes")}).parentNode.children[0].querySelector(".node"));var f=Array.from(this._closest(u,function(e){return"TABLE"===e.nodeName}).querySelectorAll(".node"));this.dragged=u,Array.from(this.chart.querySelectorAll(".node")).forEach(function(e){f.includes(e)||(r.dropCriteria?r.dropCriteria(u,h,e)&&e.classList.add("allowedDrop"):e.classList.add("allowedDrop"))})}},{key:"_onDragOver",value:function(e){e.preventDefault();e.currentTarget.classList.contains("allowedDrop")||(e.dataTransfer.dropEffect="none")}},{key:"_onDragEnd",value:function(e){Array.from(this.chart.querySelectorAll(".allowedDrop")).forEach(function(e){e.classList.remove("allowedDrop")})}},{key:"_onDrop",value:function(e){var t=e.currentTarget,r=this.chart,n=this.dragged,i=this._closest(n,function(e){return e.classList&&e.classList.contains("nodes")}).parentNode.children[0].children[0];if(this._removeClass(Array.from(r.querySelectorAll(".allowedDrop")),"allowedDrop"),t.parentNode.parentNode.nextElementSibling){var a=window.parseInt(t.parentNode.colSpan)+2;if(t.parentNode.setAttribute("colspan",a),t.parentNode.parentNode.nextElementSibling.children[0].setAttribute("colspan",a),!n.querySelector(".horizontalEdge")){var o=document.createElement("i"),s=document.createElement("i");o.setAttribute("class","edge horizontalEdge rightEdge fa"),n.appendChild(o),s.setAttribute("class","edge horizontalEdge leftEdge fa"),n.appendChild(s)}var c=t.parentNode.parentNode.nextElementSibling.nextElementSibling,l=document.createElement("td"),d=document.createElement("td");l.setAttribute("class","leftLine topLine"),l.innerHTML="&nbsp;",c.insertBefore(l,c.children[1]),d.setAttribute("class","rightLine topLine"),d.innerHTML="&nbsp;",c.insertBefore(d,c.children[2]),c.nextElementSibling.appendChild(this._closest(n,function(e){return"TABLE"===e.nodeName}).parentNode);var u=this._siblings(this._closest(n,function(e){return"TABLE"===e.nodeName}).parentNode).map(function(e){return e.querySelector(".node")});if(1===u.length){var h=document.createElement("i"),f=document.createElement("i");h.setAttribute("class","edge horizontalEdge rightEdge fa"),u[0].appendChild(h),f.setAttribute("class","edge horizontalEdge leftEdge fa"),u[0].appendChild(f)}}else{var p=document.createElement("i");p.setAttribute("class","edge verticalEdge bottomEdge fa"),t.appendChild(p),t.parentNode.setAttribute("colspan",2);var g=this._closest(t,function(e){return"TABLE"===e.nodeName}),y=document.createElement("tr"),v=document.createElement("tr"),b=document.createElement("tr");y.setAttribute("class","lines"),y.innerHTML='<td colspan="2"><div class="downLine"></div></td>',g.appendChild(y),v.setAttribute("class","lines"),v.innerHTML='<td class="rightLine">&nbsp;</td><td class="leftLine">&nbsp;</td>',g.appendChild(v),b.setAttribute("class","nodes"),g.appendChild(b),Array.from(n.querySelectorAll(".horizontalEdge")).forEach(function(e){n.removeChild(e)});var m=this._closest(n,function(e){return"TABLE"===e.nodeName}).parentNode;b.appendChild(m)}var _=window.parseInt(i.colSpan);if(_>2){i.setAttribute("colspan",_-2),i.parentNode.nextElementSibling.children[0].setAttribute("colspan",_-2);var A=i.parentNode.nextElementSibling.nextElementSibling;A.children[1].remove(),A.children[1].remove();var S=Array.from(i.parentNode.parentNode.children[3].children).map(function(e){return e.querySelector(".node")});1===S.length&&(S[0].querySelector(".leftEdge").remove(),S[0].querySelector(".rightEdge").remove())}else i.removeAttribute("colspan"),i.querySelector(".node").removeChild(i.querySelector(".bottomEdge")),Array.from(i.parentNode.parentNode.children).slice(1).forEach(function(e){return e.remove()});var E=new CustomEvent("nodedropped.orgchart",{detail:{draggedNode:n,dragZone:i.children[0],dropZone:t}});r.dispatchEvent(E)}},{key:"_createNode",value:function(e,t){var r=this,n=this.options;return new Promise(function(i,a){if(e.children){var o=!0,s=!1,c=void 0;try{for(var l,d=e.children[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){l.value.parentId=e.id}}catch(e){s=!0,c=e}finally{try{!o&&d.return&&d.return()}finally{if(s)throw c}}}var u=document.createElement("div");delete e.children,u.dataset.source=JSON.stringify(e),e[n.nodeId]&&(u.id=e[n.nodeId]);var h=r.chart.dataset.inEdit,f=void 0;f=h?"addChildren"===h?" slide-up":"":t>=n.depth?" slide-up":"",u.setAttribute("class","node "+(e.className||"")+f),n.draggable&&u.setAttribute("draggable",!0),e.parentId&&u.setAttribute("data-parent",e.parentId),u.innerHTML='\n        <div class="title">'+e[n.nodeTitle]+"</div>\n        "+(n.nodeContent?'<div class="content">'+e[n.nodeContent]+"</div>":"")+"\n      ";var p=e.relationship||"";if(n.verticalDepth&&t+2>n.verticalDepth){if(t+1>=n.verticalDepth&&Number(p.substr(2,1))){var g=document.createElement("i"),y=t+1>=n.depth?"plus":"minus";g.setAttribute("class","toggleBtn fa fa-"+y+"-square"),u.appendChild(g)}}else{if(Number(p.substr(0,1))){var v=document.createElement("i");v.setAttribute("class","edge verticalEdge topEdge fa"),u.appendChild(v)}if(Number(p.substr(1,1))){var b=document.createElement("i"),m=document.createElement("i");b.setAttribute("class","edge horizontalEdge rightEdge fa"),u.appendChild(b),m.setAttribute("class","edge horizontalEdge leftEdge fa"),u.appendChild(m)}if(Number(p.substr(2,1))){var _=document.createElement("i"),A=document.createElement("i"),S=u.querySelector(":scope > .title");_.setAttribute("class","edge verticalEdge bottomEdge fa"),u.appendChild(_),A.setAttribute("class","fa "+n.parentNodeSymbol+" symbol"),S.insertBefore(A,S.children[0])}}n.toggleCollapse&&(u.addEventListener("mouseenter",r._hoverNode.bind(r)),u.addEventListener("mouseleave",r._hoverNode.bind(r)),u.addEventListener("click",r._dispatchClickEvent.bind(r))),n.draggable&&(u.addEventListener("dragstart",r._onDragStart.bind(r)),u.addEventListener("dragover",r._onDragOver.bind(r)),u.addEventListener("dragend",r._onDragEnd.bind(r)),u.addEventListener("drop",r._onDrop.bind(r))),n.createNode&&n.createNode(u,e),i(u)})}},{key:"buildHierarchy",value:function(e,t,r,n){var i=this,a=this.options,o=void 0,s=t.children,c=a.verticalDepth&&r+1>=a.verticalDepth;if(Object.keys(t).length>1&&(o=c?e:document.createElement("table"),c||e.appendChild(o),this._createNode(t,r).then(function(e){if(c)o.insertBefore(e,o.firstChild);else{var t=document.createElement("tr");t.innerHTML="\n            <td "+(s?'colspan="'+2*s.length+'"':"")+">\n            </td>\n          ",t.children[0].appendChild(e),o.insertBefore(t,o.children[0]?o.children[0]:null)}n&&n()}).catch(function(e){console.error("Failed to creat node",e)})),s&&0!==s.length){1===Object.keys(t).length&&(o=e);var l=void 0,d=a.verticalDepth&&r+2>=a.verticalDepth,u=i.chart.dataset.inEdit;if(l=u?"addSiblings"===u?"":" hidden":r+1>=a.depth?" hidden":"",!d){var h=document.createElement("tr");h.setAttribute("class","lines"+l),h.innerHTML='\n          <td colspan="'+2*s.length+'">\n            <div class="downLine"></div>\n          </td>\n        ',o.appendChild(h)}var f=document.createElement("tr");f.setAttribute("class","lines"+l),f.innerHTML='\n        <td class="rightLine">&nbsp;</td>\n        '+s.slice(1).map(function(){return'\n          <td class="leftLine topLine">&nbsp;</td>\n          <td class="rightLine topLine">&nbsp;</td>\n          '}).join("")+'\n        <td class="leftLine">&nbsp;</td>\n      ';var p=void 0;if(d)if(p=document.createElement("ul"),l&&p.classList.add(l.trim()),r+2===a.verticalDepth){var g=document.createElement("tr");g.setAttribute("class","verticalNodes"+l),g.innerHTML="<td></td>",g.firstChild.appendChild(p),o.appendChild(g)}else o.appendChild(p);else(p=document.createElement("tr")).setAttribute("class","nodes"+l),o.appendChild(f),o.appendChild(p);s.forEach(function(e){var t=void 0;d?t=document.createElement("li"):(t=document.createElement("td")).setAttribute("colspan",2),p.appendChild(t),i.buildHierarchy(t,e,r+1,n)})}}},{key:"_clickChart",value:function(e){!this._closest(e.target,function(e){return e.classList&&e.classList.contains("node")})&&this.chart.querySelector(".node.focused")&&this.chart.querySelector(".node.focused").classList.remove("focused")}},{key:"_clickExportButton",value:function(){var e=this.options,t=this.chartContainer,r=t.querySelector(":scope > .mask"),n=t.querySelector(".orgchart:not(.hidden)"),i="l2r"===e.direction||"r2l"===e.direction;r?r.classList.remove("hidden"):((r=document.createElement("div")).setAttribute("class","mask"),r.innerHTML='<i class="fa fa-circle-o-notch fa-spin spinner"></i>',t.appendChild(r)),t.classList.add("canvasContainer"),window.html2canvas(n,{width:i?n.clientHeight:n.clientWidth,height:i?n.clientWidth:n.clientHeight,onclone:function(e){var t=e.querySelector(".canvasContainer");t.style.overflow="visible",t.querySelector(".orgchart:not(.hidden)").transform=""}}).then(function(e){var r=t.querySelector(".oc-download-btn");t.querySelector(".mask").classList.add("hidden"),r.setAttribute("href",e.toDataURL()),r.click()}).catch(function(e){console.error("Failed to export the curent orgchart!",e)}).finally(function(){t.classList.remove("canvasContainer")})}},{key:"_loopChart",value:function(e){var t=this,r={id:e.querySelector(".node").id};return e.children[3]&&Array.from(e.children[3].children).forEach(function(e){r.children||(r.children=[]),r.children.push(t._loopChart(e.firstChild))}),r}},{key:"_loopChartDataset",value:function(e){var t=this,r=JSON.parse(e.querySelector(".node").dataset.source);return e.children[3]&&Array.from(e.children[3].children).forEach(function(e){r.children||(r.children=[]),r.children.push(t._loopChartDataset(e.firstChild))}),r}},{key:"getChartJSON",value:function(){return this.chart.querySelector(".node").id?this._loopChartDataset(this.chart.querySelector("table")):"Error: Nodes of orghcart to be exported must have id attribute!"}},{key:"getHierarchy",value:function(){return this.chart.querySelector(".node").id?this._loopChart(this.chart.querySelector("table")):"Error: Nodes of orghcart to be exported must have id attribute!"}},{key:"_onPanStart",value:function(e){var t=e.currentTarget;if(this._closest(e.target,function(e){return e.classList&&e.classList.contains("node")})||e.touches&&e.touches.length>1)t.dataset.panning=!1;else{t.style.cursor="move",t.dataset.panning=!0;var r=0,n=0,i=window.getComputedStyle(t).transform;if("none"!==i){var a=i.split(",");i.includes("3d")?(r=Number.parseInt(a[12],10),n=Number.parseInt(a[13],10)):(r=Number.parseInt(a[4],10),n=Number.parseInt(a[5],10))}var o=0,s=0;if(e.targetTouches){if(1===e.targetTouches.length)o=e.targetTouches[0].pageX-r,s=e.targetTouches[0].pageY-n;else if(e.targetTouches.length>1)return}else o=e.pageX-r,s=e.pageY-n;t.dataset.panStart=JSON.stringify({startX:o,startY:s}),t.addEventListener("mousemove",this._onPanning.bind(this)),t.addEventListener("touchmove",this._onPanning.bind(this))}}},{key:"_onPanning",value:function(e){var t=e.currentTarget;if("false"!==t.dataset.panning){var r=0,n=0,i=JSON.parse(t.dataset.panStart),a=i.startX,o=i.startY;if(e.targetTouches){if(1===e.targetTouches.length)r=e.targetTouches[0].pageX-a,n=e.targetTouches[0].pageY-o;else if(e.targetTouches.length>1)return}else r=e.pageX-a,n=e.pageY-o;var s=window.getComputedStyle(t).transform;if("none"===s)s.includes("3d")?t.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+r+", "+n+", 0, 1)":t.style.transform="matrix(1, 0, 0, 1, "+r+", "+n+")";else{var c=s.split(",");s.includes("3d")?(c[12]=r,c[13]=n):(c[4]=r,c[5]=n+")"),t.style.transform=c.join(",")}}}},{key:"_onPanEnd",value:function(e){var t=this.chart;"true"===t.dataset.panning&&(t.dataset.panning=!1,t.style.cursor="default",document.body.removeEventListener("mousemove",this._onPanning),document.body.removeEventListener("touchmove",this._onPanning))}},{key:"_setChartScale",value:function(e,t){var r=window.getComputedStyle(e).transform;if("none"===r)e.style.transform="scale("+t+","+t+")";else{var n=r.split(",");r.includes("3d")?e.style.transform=r+" scale3d("+t+","+t+", 1)":(n[0]="matrix("+t,n[3]=t,e.style.transform=r+" scale("+t+","+t+")")}e.dataset.scale=t}},{key:"_onWheeling",value:function(e){e.preventDefault();var t=e.deltaY>0?.8:1.2;this._setChartScale(this.chart,t)}},{key:"_getPinchDist",value:function(e){return Math.sqrt((e.touches[0].clientX-e.touches[1].clientX)*(e.touches[0].clientX-e.touches[1].clientX)+(e.touches[0].clientY-e.touches[1].clientY)*(e.touches[0].clientY-e.touches[1].clientY))}},{key:"_onTouchStart",value:function(e){var t=this.chart;if(e.touches&&2===e.touches.length){var r=this._getPinchDist(e);t.dataset.pinching=!0,t.dataset.pinchDistStart=r}}},{key:"_onTouchMove",value:function(e){var t=this.chart;if(t.dataset.pinching){var r=this._getPinchDist(e);t.dataset.pinchDistEnd=r}}},{key:"_onTouchEnd",value:function(e){var t=this.chart;if(t.dataset.pinching){t.dataset.pinching=!1;var r=t.dataset.pinchDistEnd-t.dataset.pinchDistStart;r>0?this._setChartScale(t,1):r<0&&this._setChartScale(t,-1)}}},{key:"name",get:function(){return this._name}}]),e}(),arrayProto=Array.prototype,splice=arrayProto.splice;ListCache.prototype.clear=listCacheClear,ListCache.prototype.delete=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet;var freeGlobal="object"==typeof global&&global&&global.Object===Object&&global,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),Symbol$1=root.Symbol,objectProto$1=Object.prototype,hasOwnProperty$1=objectProto$1.hasOwnProperty,nativeObjectToString=objectProto$1.toString,symToStringTag$1=Symbol$1?Symbol$1.toStringTag:void 0,objectProto$2=Object.prototype,nativeObjectToString$1=objectProto$2.toString,nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=Symbol$1?Symbol$1.toStringTag:void 0,asyncTag="[object AsyncFunction]",funcTag="[object Function]",genTag="[object GeneratorFunction]",proxyTag="[object Proxy]",coreJsData=root["__core-js_shared__"],maskSrcKey=function(){var e=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),funcProto$1=Function.prototype,funcToString$1=funcProto$1.toString,reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto=Function.prototype,objectProto=Object.prototype,funcToString=funcProto.toString,hasOwnProperty=objectProto.hasOwnProperty,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Map=getNative(root,"Map"),nativeCreate=getNative(Object,"create"),HASH_UNDEFINED="__lodash_hash_undefined__",objectProto$3=Object.prototype,hasOwnProperty$2=objectProto$3.hasOwnProperty,objectProto$4=Object.prototype,hasOwnProperty$3=objectProto$4.hasOwnProperty,HASH_UNDEFINED$1="__lodash_hash_undefined__";Hash.prototype.clear=hashClear,Hash.prototype.delete=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet,MapCache.prototype.clear=mapCacheClear,MapCache.prototype.delete=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet;var LARGE_ARRAY_SIZE=200;Stack.prototype.clear=stackClear,Stack.prototype.delete=stackDelete,Stack.prototype.get=stackGet,Stack.prototype.has=stackHas,Stack.prototype.set=stackSet;var defineProperty$1=function(){try{var e=getNative(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),baseFor=createBaseFor(),freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule=freeExports&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports,Buffer=moduleExports?root.Buffer:void 0,allocUnsafe=Buffer?Buffer.allocUnsafe:void 0,Uint8Array=root.Uint8Array,objectCreate=Object.create,baseCreate=function(){function e(){}return function(t){if(!isObject(t))return{};if(objectCreate)return objectCreate(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),getPrototype=overArg(Object.getPrototypeOf,Object),objectProto$5=Object.prototype,argsTag="[object Arguments]",objectProto$6=Object.prototype,hasOwnProperty$4=objectProto$6.hasOwnProperty,propertyIsEnumerable=objectProto$6.propertyIsEnumerable,isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(e){return isObjectLike(e)&&hasOwnProperty$4.call(e,"callee")&&!propertyIsEnumerable.call(e,"callee")},isArray=Array.isArray,MAX_SAFE_INTEGER=9007199254740991,freeExports$1="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule$1=freeExports$1&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports$1=freeModule$1&&freeModule$1.exports===freeExports$1,Buffer$1=moduleExports$1?root.Buffer:void 0,nativeIsBuffer=Buffer$1?Buffer$1.isBuffer:void 0,isBuffer=nativeIsBuffer||stubFalse,objectTag="[object Object]",funcProto$2=Function.prototype,objectProto$7=Object.prototype,funcToString$2=funcProto$2.toString,hasOwnProperty$5=objectProto$7.hasOwnProperty,objectCtorString=funcToString$2.call(Object),argsTag$1="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag$1="[object Function]",mapTag="[object Map]",numberTag="[object Number]",objectTag$1="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",weakMapTag="[object WeakMap]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0,typedArrayTags[argsTag$1]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag$1]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag$1]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=!1;var freeExports$2="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule$2=freeExports$2&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports$2=freeModule$2&&freeModule$2.exports===freeExports$2,freeProcess=moduleExports$2&&freeGlobal.process,nodeUtil=function(){try{return freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}(),nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray,isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray,objectProto$8=Object.prototype,hasOwnProperty$6=objectProto$8.hasOwnProperty,MAX_SAFE_INTEGER$1=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/,objectProto$9=Object.prototype,hasOwnProperty$7=objectProto$9.hasOwnProperty,objectProto$10=Object.prototype,hasOwnProperty$8=objectProto$10.hasOwnProperty,nativeMax=Math.max,baseSetToString=defineProperty$1?function(e,t){return defineProperty$1(e,"toString",{configurable:!0,enumerable:!1,value:constant(t),writable:!0})}:identity,HOT_COUNT=800,HOT_SPAN=16,nativeNow=Date.now,setToString=shortOut(baseSetToString),merge=createAssigner(function(e,t,r){baseMerge(e,t,r)}),mergeOptions=function(e,t){return merge(e,t)},VoBasic={render:function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"vo-basic",attrs:{id:"chart-container"}})},staticRenderFns:[],name:"orgchart",props:{data:{type:Object,default:function(){return{}}},pan:{type:Boolean,default:!1},zoom:{type:Boolean,default:!1},direction:{type:String,default:"t2b"},verticalDepth:{type:Number},toggleSiblingsResp:{type:Boolean,default:!1},ajaxURL:{type:Object},depth:{type:Number,default:999},nodeTitle:{type:String,default:"name"},parentNodeSymbol:{type:String,default:""},nodeContent:{type:String},nodeId:{type:String,default:"id"},createNode:{type:Function},exportButton:{type:Boolean,default:!1},exportButtonName:{type:String,default:"Export"},exportFilename:{type:String},chartClass:{type:String,default:""},draggable:{type:Boolean,default:!1},dropCriteria:{type:Function},toggleCollapse:{type:Boolean,default:!0}},data:function(){return{newData:null,orgchart:null,defaultOptions:{chartContainer:"#chart-container"}}},mounted:function(){null===this.newData&&this.initOrgChart()},methods:{initOrgChart:function(){var e=mergeOptions(this.defaultOptions,this.$props);this.orgchart=new OrgChart$1(e)}},watch:{data:function(e){var t=this;this.newData=e;new Promise(function(t){e&&t()}).then(function(){var e=mergeOptions(t.defaultOptions,t.$props);t.orgchart=new OrgChart$1(e)})}}},closest=function e(t,r){return t&&(r(t)&&t!==document.querySelector(".orgchart")?t:e(t.parentNode,r))},bindEventHandler=function(e,t,r,n){n?document.querySelector(n).addEventListener(t,function(t){(t.target.classList&&t.target.classList.contains(e.slice(1))||closest(t.target,function(t){return t.classList&&t.classList.contains(e.slice(1))}))&&r(t)}):document.querySelectorAll(e).forEach(function(e){e.addEventListener(t,r)})},clickNode=function(e){var t=closest(e.target,function(e){return e.classList&&e.classList.contains("node")}),r=document.getElementById("selected-node");r.value=t.querySelector(".title").textContent,r.dataset.node=t.id},clickChart=function(e){closest(e.target,function(e){return e.classList&&e.classList.contains("node")})||(document.getElementById("selected-node").textContent="")},getId=function(){return 1e3*(new Date).getTime()+Math.floor(1001*Math.random())},VoEdit={render:function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"vo-edit",attrs:{id:"chart-container"}})},staticRenderFns:[],name:"VoEdit",props:{data:{type:Object},pan:{type:Boolean,default:!1},zoom:{type:Boolean,default:!1},direction:{type:String,default:"t2b"},verticalDepth:{type:Number},toggleSiblingsResp:{type:Boolean,default:!1},ajaxURL:{type:Object},depth:{type:Number,default:999},nodeTitle:{type:String,default:"name"},parentNodeSymbol:{type:String,default:""},nodeContent:{type:String},nodeId:{type:String,default:"id"},createNode:{type:Function},exportButton:{type:Boolean,default:!1},exportButtonName:{type:String,default:"Export"},exportFilename:{type:String},chartClass:{type:String,default:""},draggable:{type:Boolean,default:!1},dropCriteria:{type:Function},toggleCollapse:{type:Boolean,default:!0}},data:function(){return{newData:null,orgchart:null,defaultOptions:{chartContainer:"#chart-container",createNode:function(e,t){e.id=getId()}}}},mounted:function(){null===this.newData&&this.initOrgChart(),this.$nextTick(function(){bindEventHandler(".node","click",clickNode,"#chart-container"),bindEventHandler(".orgchart","click",clickChart,"#chart-container")})},methods:{initOrgChart:function(){var e=mergeOptions(this.defaultOptions,this.$props);this.orgchart=new OrgChart$1(e)}},watch:{data:function(e){var t=this;this.newData=e;new Promise(function(t){e&&t()}).then(function(){var e=mergeOptions(t.defaultOptions,t.$props);t.orgchart=new OrgChart$1(e)})}}};"undefined"!=typeof window&&window.Vue&&(window.Vue.component("vo-basic",VoBasic),window.Vue.component("vo-edit",VoEdit)),exports.VoBasic=VoBasic,exports.VoEdit=VoEdit;
